<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tapkuang Vaiphei Dictionary</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f9f9f9; }
    .page { display: none; padding: 20px; text-align: center; }
    .menu button { display: block; margin: 10px auto; padding: 12px 20px; font-size: 16px; width: 220px; border-radius: 6px; border: none; background: #0066cc; color: white; cursor: pointer; }
    .menu button:hover { background: #004999; }
    .alphabet button { margin: 3px; padding: 5px 10px; border: 1px solid #ccc; background: #eee; cursor: pointer; border-radius: 4px; }
    .alphabet button:hover { background: #ddd; }
    .word-entry { border-bottom: 1px solid #ccc; padding: 6px; text-align: left; max-width: 600px; margin: 0 auto; }
    img.cover { width: 100%; max-height: 400px; object-fit: cover; display: block; }
    h1 { margin: 15px 0; font-size: 28px; }
    h2 { margin-top: 10px; }
    .import-area { margin: 15px 0; }
    input[type="file"] { margin: 10px auto; display: block; }
  </style>
  <!-- SheetJS -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>

<!-- ================= HOME PAGE ================= -->
<div id="homePage" class="page" style="display:block">
  <img src="Dictionary.png" alt="Cover" class="cover">
  <h1>TAPKUANG VAIPHEI DICTIONARY</h1>
  <p>By PH Thianneilal Vaiphei</p>
  <div class="menu">
    <button onclick="showPage('searchMenu')">ğŸ” Hawlna (Search)</button>
    <button onclick="showPage('dictionaryMenu')">ğŸ“– Thumalhilchianna (Dictionary)</button>
    <button onclick="showPage('importPage')">â¬† Import Excel</button>
    <button onclick="exportToExcel('v2e')">â¬‡ Export Vâ†’E Excel</button>
    <button onclick="exportToExcel('e2v')">â¬‡ Export Eâ†’V Excel</button>
    <button onclick="showPage('aboutPage')">â„¹ About</button>
  </div>
</div>

<!-- ================= SEARCH MENU ================= -->
<div id="searchMenu" class="page">
  <h2>ğŸ” Hawlna (Search)</h2>
  <button onclick="showPage('searchV2E')">Vaiphei â†’ English</button>
  <button onclick="showPage('searchE2V')">English â†’ Vaiphei</button>
  <button onclick="showPage('homePage')">ğŸ  Back</button>
</div>

<!-- ================= DICTIONARY MENU ================= -->
<div id="dictionaryMenu" class="page">
  <h2>ğŸ“– Thumalhilchianna (Dictionary)</h2>
  <button onclick="showPage('dictV2E')">Vaiphei â†’ English</button>
  <button onclick="showPage('dictE2V')">English â†’ Vaiphei</button>
  <button onclick="showPage('homePage')">ğŸ  Back</button>
</div>

<!-- ================= SEARCH PAGES ================= -->
<div id="searchV2E" class="page">
  <h2>Vaiphei â†’ English (Search)</h2>
  <div id="v2eFilter" class="alphabet"></div>
  <input type="text" id="searchInputV2E" placeholder="Search Vaiphei word...">
  <div id="resultsV2E"></div>
  <button onclick="showPage('searchMenu')">â¬… Back</button>
</div>

<div id="searchE2V" class="page">
  <h2>English â†’ Vaiphei (Search)</h2>
  <div id="e2vFilter" class="alphabet"></div>
  <input type="text" id="searchInputE2V" placeholder="Search English word...">
  <div id="resultsE2V"></div>
  <button onclick="showPage('searchMenu')">â¬… Back</button>
</div>

<!-- ================= FULL DICTIONARY PAGES ================= -->
<div id="dictV2E" class="page">
  <h2>Full Vaiphei â†’ English Dictionary</h2>
  <div id="dictListV2E"></div>
  <button onclick="showPage('dictionaryMenu')">â¬… Back</button>
</div>

<div id="dictE2V" class="page">
  <h2>Full English â†’ Vaiphei Dictionary</h2>
  <div id="dictListE2V"></div>
  <button onclick="showPage('dictionaryMenu')">â¬… Back</button>
</div>

<!-- ================= IMPORT PAGE ================= -->
<div id="importPage" class="page">
  <h2>â¬† Import Excel</h2>
  <div class="import-area">
    <h3>Vaiphei â†’ English</h3>
    <input type="file" id="importV2E" accept=".xlsx">
  </div>
  <div class="import-area">
    <h3>English â†’ Vaiphei</h3>
    <input type="file" id="importE2V" accept=".xlsx">
  </div>
  <button onclick="showPage('homePage')">ğŸ  Back</button>
</div>

<!-- ================= ABOUT PAGE ================= -->
<div id="aboutPage" class="page">
  <h2>About</h2>
  <p>
    This dictionary is built for the Vaiphei community to preserve and share our language.  
    It is a tool for students, teachers, and all who wish to learn.  
    Thank you.
  </p>
  <button onclick="showPage('homePage')">ğŸ  Back</button>
</div>

<!-- ================= SCRIPT ================= -->
<script>
// ================= PAGE NAVIGATION =================
function showPage(id) {
  document.querySelectorAll(".page").forEach(p => p.style.display = "none");
  document.getElementById(id).style.display = "block";
}

// ================= LOCAL STORAGE =================
let v2eData = JSON.parse(localStorage.getItem("v2eData")) || [];
let e2vData = JSON.parse(localStorage.getItem("e2vData")) || [];

function saveData() {
  localStorage.setItem("v2eData", JSON.stringify(v2eData));
  localStorage.setItem("e2vData", JSON.stringify(e2vData));
}

// ================= ALPHABET FILTERS =================
const v2eAlphabet = ["A","AW","B","CH","D","E","F","G","NG","H","I","J","K","L","M","N","O","P","R","S","T","U","V","Z"];
const e2vAlphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");

function buildAlphabet(containerId, type) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";
  const letters = type === "v2e" ? v2eAlphabet : e2vAlphabet;
  letters.forEach(letter => {
    let btn = document.createElement("button");
    btn.textContent = letter;
    btn.onclick = () => filterByLetter(letter, type);
    container.appendChild(btn);
  });
}

// ================= SEARCH =================
function searchDictionary(inputId, resultsId, type) {
  const query = document.getElementById(inputId).value.toLowerCase();
  const resultsDiv = document.getElementById(resultsId);
  resultsDiv.innerHTML = "";

  let data = (type === "v2e") ? v2eData : e2vData;
  let filtered = data.filter(entry => entry.word.toLowerCase().includes(query));
  displayResults(filtered, resultsDiv);
}

function filterByLetter(letter, type) {
  const resultsDiv = (type === "v2e") ? document.getElementById("resultsV2E") : document.getElementById("resultsE2V");
  resultsDiv.innerHTML = "";

  let data = (type === "v2e") ? v2eData : e2vData;
  let filtered = data.filter(entry => entry.word.toUpperCase().startsWith(letter));
  displayResults(filtered, resultsDiv);
}

function displayResults(list, container) {
  if (list.length === 0) {
    container.innerHTML = "<p>No results found.</p>";
    return;
  }
  list.forEach(entry => {
    let div = document.createElement("div");
    div.className = "word-entry";
    div.innerHTML = `<b>${entry.word}</b> â†’ ${entry.meaning}`;
    container.appendChild(div);
  });
}

// ================= FULL DICTIONARY =================
function buildFullDictionary(containerId, type) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";

  let data = (type === "v2e") ? v2eData : e2vData;
  let letters = (type === "v2e") ? v2eAlphabet : e2vAlphabet;

  letters.forEach(letter => {
    let group = data.filter(entry => entry.word.toUpperCase().startsWith(letter));
    if (group.length > 0) {
      let section = document.createElement("div");
      section.innerHTML = `<h3>${letter}</h3>`;
      group.forEach(entry => {
        let p = document.createElement("p");
        p.innerHTML = `<b>${entry.word}</b> â†’ ${entry.meaning}`;
        section.appendChild(p);
      });
      container.appendChild(section);
    }
  });
}

// ================= EXPORT TO EXCEL =================
function exportToExcel(type) {
  let data = (type === "v2e") ? v2eData : e2vData;
  let ws = XLSX.utils.json_to_sheet(data);
  let wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, type === "v2e" ? "Vaiphei-English" : "English-Vaiphei");
  XLSX.writeFile(wb, type === "v2e" ? "vaiphei_to_english.xlsx" : "english_to_vaiphei.xlsx");
}

// ================= IMPORT EXCEL =================
function importExcel(file, type) {
  const reader = new FileReader();
  reader.onload = (e) => {
    const data = new Uint8Array(e.target.result);
    const workbook = XLSX.read(data, { type: 'array' });
    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
    const json = XLSX.utils.sheet_to_json(firstSheet);
    if (type === "v2e") {
      v2eData = json.map(row => ({ word: row.Word, meaning: row.Meaning }));
    } else {
      e2vData = json.map(row => ({ word: row.Word, meaning: row.Meaning }));
    }
    saveData();
    buildFullDictionary("dictListV2E", "v2e");
    buildFullDictionary("dictListE2V", "e2v");
    alert("Import successful for " + (type === "v2e" ? "Vaipheiâ†’English" : "Englishâ†’Vaiphei"));
  };
  reader.readAsArrayBuffer(file);
}

document.getElementById("importV2E").addEventListener("change", (e) => {
  importExcel(e.target.files[0], "v2e");
});
document.getElementById("importE2V").addEventListener("change", (e) => {
  importExcel(e.target.files[0], "e2v");
});

// ================= INIT =================
document.addEventListener("DOMContentLoaded", () => {
  buildAlphabet("v2eFilter", "v2e");
  buildAlphabet("e2vFilter", "e2v");

  document.getElementById("searchInputV2E").addEventListener("input", () => {
    searchDictionary("searchInputV2E", "resultsV2E", "v2e");
  });
  document.getElementById("searchInputE2V").addEventListener("input", () => {
    searchDictionary("searchInputE2V", "resultsE2V", "e2v");
  });

  buildFullDictionary("dictListV2E", "v2e");
  buildFullDictionary("dictListE2V", "e2v");
});
</script>
</body>
</html>
