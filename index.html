<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tapkuang - Vaiphei Dictionary by PH THIANNEILAL VAIPHEI</title>
<meta name="theme-color" content="#8b5e00" />
<meta name="description" content="Tapkuang - Vaiphei Dictionary (Vaiphei â†” English)" />
<link rel="manifest" href="manifest.webmanifest">

<style>
  :root{--bg:#fffaf0;--ink:#3a2f0b;--gold:#b8860b}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;background:linear-gradient(180deg,#fffdf6,#fbf6e0);color:var(--ink)}
  .wrap{max-width:960px;margin:18px auto;padding:16px}
  .card{background:#fff;border-radius:12px;padding:16px;border:1px solid #efe6c2;box-shadow:0 10px 30px rgba(0,0,0,.05)}
  header{display:flex;justify-content:space-between;align-items:center}
  h1{margin:0;font-size:20px}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px}
  .btn{padding:10px;border-radius:10px;border:1px solid #e6d8a8;background:#fff;cursor:pointer;text-align:left}
  .btn small{display:block;color:#666;font-size:12px}
  .content{margin-top:14px}
  .input{padding:10px;border-radius:10px;border:1px solid #e6d8a8;width:100%}
  .alphabet{display:flex;flex-wrap:wrap;gap:6px;margin:8px 0}
  .pill{padding:6px 8px;border-radius:999px;border:1px solid #e6d8a8;background:#fff;cursor:pointer}
  .pill.active{background:#fff2b3}
  .list{display:flex;flex-direction:column;gap:8px}
  .entry{padding:10px;border-radius:10px;background:#fffdf6;border:1px solid #efe2b0;display:flex;justify-content:space-between;align-items:flex-start}
  .small{font-size:13px;color:#666}
  .modal-back{position:fixed;inset:0;background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;padding:12px}
  .modal{background:#fff;padding:12px;border-radius:10px;max-width:520px;width:100%;border:1px solid #efe2b0}
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:20px;background:#1d7f39;color:#fff;padding:8px 12px;border-radius:10px;display:none}
  footer{margin-top:12px;font-size:12px;color:#666;text-align:center}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div>
          <h1>Tapkuang - Vaiphei Dictionary</h1>
          <div class="small">By PH THIANNEILAL VAIPHEI</div>
        </div>
        <div id="authStatus" class="small">Guest</div>
      </header>

      <div class="grid" id="menuGrid"></div>

      <div class="content" id="content"></div>
    </div>

    <footer>
      <div id="authorIntro" class="small">
        <!-- Author intro will be injected -->
      </div>
    </footer>
  </div>

  <div id="toast" class="toast"></div>

  <script>
  /***************  CONFIG & PRELOADED DATA  ***************/
  // Admin defaults
  const DEFAULT_ADMIN = { username: "Thianlal Vaiphei", email: "Lalvaiphei60@gmail.com" };

  // Vaiphei alphabet custom order
  const VA_ALPH = ['ALL','A','AW','B','CH','D','E','F','G','NG','H','I','J','K','L','M','N','O','P','R','S','T','U','V','Z'];
  const EN_ALPH = ['ALL','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];
  const PAGE_SIZE = 20;

  // Preloaded sample entries (will be merged with existing localStorage on first run).
  // If you have a prepared data.json or Excel, you can replace this list.
  const PRELOADED = [
    {"vaiphei":"A pha","english":"Good","example":""},
    {"vaiphei":"A hawi","english":"Beautiful","example":""},
    {"vaiphei":"A zang","english":"Straight","example":""},
    {"vaiphei":"A kawi","english":"Bend/Crook","example":""},
    {"vaiphei":"A sau","english":"Long","example":""},
    {"vaiphei":"A neu","english":"Small/tiny","example":""},
    {"vaiphei":"A lian","english":"Big/Large","example":""}
  ];

  /***************  STORAGE HELPERS & AUTH  ***************/
  const LS_DICT = 'tapkuang-dict';
  const LS_ADMIN = 'tapkuang-admin'; // stores { username, email, passHash, recHash }

  // Hash function for simple client-side password hashing (SHA-256 hex)
  async function sha256hex(txt){
    const enc = new TextEncoder().encode(txt);
    const buf = await crypto.subtle.digest('SHA-256', enc);
    return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
  }

  function loadDict(){
    try{
      const raw = localStorage.getItem(LS_DICT);
      if(!raw){
        // seed with PRELOADED and save
        localStorage.setItem(LS_DICT, JSON.stringify(PRELOADED));
        return [...PRELOADED];
      }
      return JSON.parse(raw);
    }catch(e){ return []; }
  }
  function saveDict(arr){ localStorage.setItem(LS_DICT, JSON.stringify(arr)); }

  function loadAdmin(){
    try{ return JSON.parse(localStorage.getItem(LS_ADMIN) || 'null'); }catch(e){ return null; }
  }
  function saveAdmin(obj){ localStorage.setItem(LS_ADMIN, JSON.stringify(obj)); }

  // If there's no admin object yet, create with defaults but empty hashes
  if(!loadAdmin()){
    saveAdmin({ username: DEFAULT_ADMIN.username, email: DEFAULT_ADMIN.email, passHash: '', recHash: '' });
  }

  /***************  APP STATE  ***************/
  let state = {
    mode: 'VA2EN', // VA2EN or EN2VA
    pageKey: 'home', // home, search, dictionary, import, add, settings, login
    query: '',
    letter: 'ALL',
    page: 0,
    dict: loadDict(),
    adminLogged: false
  };

  /***************  UI BUILDERS  ***************/
  const menuItems = [
    { key: "home", label: "Home", sub: "" },
    { key: "search", label: "Hawlna", sub: "Search" },
    { key: "dictionary", label: "Thumalhilchian", sub: "Dictionary" },
    { key: "import", label: "Excel laklutna", sub: "Import CSV/XLSX" },
    { key: "add", label: "Thumal belapna", sub: "Add Word" },
    { key: "settings", label: "Munpi", sub: "Settings" },
    { key: "login", label: "Lutna", sub: "Login/Setup" },
    { key: "logout", label: "Pawtna", sub: "Logout" }
  ];

  function el(tag, attrs={}, ...children){
    const e = document.createElement(tag);
    for(const k in attrs) {
      if(k.startsWith('on') && typeof attrs[k] === 'function') e.addEventListener(k.slice(2), attrs[k]);
      else if(k==='html') e.innerHTML = attrs[k];
      else e.setAttribute(k, attrs[k]);
    }
    for(const c of children) if(c!=null) e.append(typeof c==='string'?document.createTextNode(c):c);
    return e;
  }

  function showToast(msg){
    const t = document.getElementById('toast'); t.textContent = msg; t.style.display = 'block';
    setTimeout(()=>t.style.display = 'none', 1800);
  }

  /***************  SORT / FILTER HELPERS  ***************/
  function firstTokenVA(w){
    if(!w) return '';
    const W = w.toUpperCase();
    if(W.startsWith('AW')) return 'AW';
    if(W.startsWith('CH')) return 'CH';
    if(W.startsWith('NG')) return 'NG';
    return W[0];
  }
  const vaOrder = new Map(VA_ALPH.map((l,i)=>[l,i]));
  function compareEntries(a,b){
    if(state.mode === 'VA2EN'){
      const A = firstTokenVA(a.vaiphei), B = firstTokenVA(b.vaiphei);
      const ai = vaOrder.get(A) ?? 999, bi = vaOrder.get(B) ?? 999;
      if(ai !== bi) return ai - bi;
      return a.vaiphei.localeCompare(b.vaiphei);
    } else {
      return (a.english || '').localeCompare(b.english || '');
    }
  }

  /***************  RENDER: Menu + Content  ***************/
  function renderMenu(){
    const mg = document.getElementById('menuGrid');
    mg.innerHTML = '';
    menuItems.forEach(it=>{
      const btn = el('button', { class:'btn', onclick: ()=>{ state.pageKey = it.key; state.page = 0; render(); } });
      btn.append(el('div', {}, it.label));
      btn.append(el('small', {}, it.sub));
      mg.appendChild(btn);
    });
  }

  function renderAuthorIntro(){
    const intro = `I want to make Vaiphei Dictionary App since my Higher Secondary School days. But due to lack of my knowledge in Information and Technology I concealed my dreams for many days. But today I can make out my long dreams â€˜Tapkuang â€“ Vaiphei Dictionary Appâ€™ which is the first Vaiphei Dictionary in App form. I give utmost thanks to God Almighty who made live my dormant dream. I hope this Dictionary serves all the Vaipheis and those who use this language in building up their vocabularies which can enable them to have self-confidence in using English and Vaiphei. All users are requested to help correct mistakes. May God use this App for all the users, especially the younger generation who have learning zeal. Thank you. â€” PH Thianneilal Vaiphei`;
    document.getElementById('authorIntro').textContent = intro;
  }

  function render(){
    renderMenu();
    renderAuthorIntro();
    document.getElementById('authStatus').textContent = state.adminLogged ? `Admin: ${loadAdmin().username}` : 'Guest';
    const content = document.getElementById('content');
    content.innerHTML = '';
    if(state.pageKey === 'home'){
      content.appendChild(el('div', { class:'card' }, el('p', { class:'small' }, 'ðŸ‘‹ Tapkuang â€“ Vaiphei Dictionary. Use Hawlna (Search) or Thumalhilchian (Dictionary).')));
      return;
    }
    if(state.pageKey === 'search' || state.pageKey === 'dictionary'){
      // search bar
      const searchBox = el('div', {},
        el('input', { class:'input', placeholder:'Hawlna (search)â€¦', value: state.query, oninput: (e)=>{ state.query = e.target.value; state.page = 0; render(); } })
      );
      content.appendChild(searchBox);
      // alphabet
      const alphWrap = el('div', { class:'alphabet' });
      const letters = state.mode === 'VA2EN' ? VA_ALPH : EN_ALPH;
      letters.forEach(L=>{
        const b = el('button', { class:'pill' + (L === state.letter ? ' active' : ''), onclick: ()=>{ state.letter = L; state.page = 0; render(); } }, L);
        alphWrap.appendChild(b);
      });
      content.appendChild(alphWrap);

      // list
      const list = el('div', { class:'list' });
      const filtered = state.dict.filter(it=>{
        const q = (state.query||'').toLowerCase();
        const matchesQ = !q || (it.vaiphei||'').toLowerCase().includes(q) || (it.english||'').toLowerCase().includes(q);
        const matchesL = state.letter === 'ALL' || (state.mode==='VA2EN' ? firstTokenVA(it.vaiphei) === state.letter : ((it.english||'')[0]||'').toUpperCase() === state.letter);
        return matchesQ && matchesL;
      }).sort(compareEntries);
      const totalPages = Math.max(1, Math.ceil(filtered.length / PAGE_SIZE));
      state.page = Math.min(Math.max(state.page, 0), totalPages-1);
      const pageSlice = filtered.slice(state.page*PAGE_SIZE, state.page*PAGE_SIZE + PAGE_SIZE);
      if(pageSlice.length === 0) list.appendChild(el('p', { class:'small' }, 'No entries.'));

      pageSlice.forEach((it, idx)=>{
        const entry = el('div', { class:'entry' });
        const left = el('div', {}, el('div', { style:'font-weight:600' }, it.vaiphei), el('div', { class:'small' }, it.english));
        if(it.example) left.appendChild(el('div', { class:'small' }, it.example));
        entry.appendChild(left);
        const right = el('div', {});
        if(state.adminLogged){
          const editBtn = el('button', { class:'btn', onclick: ()=>openEditEntry(it) }, 'Edit');
          const delBtn = el('button', { class:'btn', onclick: ()=>{ if(confirm('Delete this entry?')){ state.dict = state.dict.filter(d=>!(d.vaiphei===it.vaiphei && d.english===it.english)); saveDict(state.dict); showToast('Deleted'); render(); } } }, 'Delete');
          right.appendChild(editBtn); right.appendChild(delBtn);
        }
        entry.appendChild(right);
        list.appendChild(entry);
      });

      content.appendChild(list);

      // pager
      if(filtered.length > PAGE_SIZE){
        const pager = el('div', { style:'display:flex;justify-content:space-between;align-items:center;margin-top:8px' },
          el('button', { class:'pill', onclick: ()=>{ if(state.page>0){ state.page--; render(); } } }, 'â†'),
          el('div', {}, `Page ${state.page+1} / ${totalPages}`),
          el('button', { class:'pill', onclick: ()=>{ if((state.page+1)*PAGE_SIZE < filtered.length){ state.page++; render(); } } }, 'â†’')
        );
        content.appendChild(pager);
      }
      return;
    }

    if(state.pageKey === 'import'){
      const imp = el('div', { class:'card' },
        el('div', {}, el('input', { type:'file', id:'fileInput', class:'input' })),
        el('div', { style:'margin-top:8px' },
          el('button', { class:'btn', onclick: ()=>doImportCSV() }, 'Import CSV'),
          el('button', { class:'btn', onclick: ()=>doExportCSV() }, 'Export CSV')
        ),
        el('p', { class:'small' }, 'CSV header: Vaiphei,English,Example. Full .xlsx import works if you add SheetJS to the folder and enable it.')
      );
      content.appendChild(imp);
      return;
    }

    if(state.pageKey === 'add'){
      if(!state.adminLogged){
        content.appendChild(el('p', { class:'small' }, 'âš ï¸ Admin only. Please Lutna (Login).'));
        return;
      }
      // Add form
      const form = el('div', {},
        el('input', { id:'add-va', class:'input', placeholder:'Vaiphei' }),
        el('input', { id:'add-en', class:'input', placeholder:'English', style:'margin-top:8px' }),
        el('input', { id:'add-ex', class:'input', placeholder:'Example (optional)', style:'margin-top:8px' }),
        el('div', { style:'margin-top:8px' }, el('button', { class:'btn', onclick: ()=>{ const va = document.getElementById('add-va').value.trim(); const en = document.getElementById('add-en').value.trim(); const ex = document.getElementById('add-ex').value.trim(); if(!va||!en) return alert('Vaiphei and English required'); const key = (va+'â†’'+en).toLowerCase(); if(state.dict.some(d=> (d.vaiphei+'â†’'+d.english).toLowerCase()===key )) return alert('Duplicate'); state.dict.push({vaiphei:va,english:en,example:ex}); state.dict.sort(compareEntries); saveDict(state.dict); showToast('Word added'); document.getElementById('add-va').value=''; document.getElementById('add-en').value=''; document.getElementById('add-ex').value=''; render(); } }, 'Add Word') )
      );
      content.appendChild(form);
      return;
    }

    if(state.pageKey === 'settings'){
      const adm = loadAdmin();
      const sec = el('div', { class:'card' },
        el('div', {}, `Admin: ${adm.username} â€¢ ${adm.email}`),
        el('div', { style:'margin-top:8px' }, el('input', { id:'chg-pass', class:'input', placeholder:'New password (leave blank to keep)' })),
        el('div', { style:'margin-top:8px' }, el('input', { id:'chg-rec', class:'input', placeholder:'New recovery code (write down!)' })),
        el('div', { style:'margin-top:8px' }, el('button', { class:'btn', onclick: async ()=>{ const p = document.getElementById('chg-pass').value; const r = document.getElementById('chg-rec').value; const current = loadAdmin(); if(p) current.passHash = await sha256hex(p); if(r) current.recHash = await sha256hex(r); saveAdmin(current); document.getElementById('chg-pass').value=''; document.getElementById('chg-rec').value=''; showToast('Saved'); } }, 'Save') )
      );
      content.appendChild(sec);
      // export option
      content.appendChild(el('div', { style:'margin-top:10px' }, el('button', { class:'btn', onclick: ()=>doExportCSV() }, 'Export CSV')));
      content.appendChild(el('div', { style:'margin-top:6px' }, el('button', { class:'btn', onclick: ()=>{ if(confirm('Clear all data?')){ state.dict = []; saveDict(state.dict); showToast('Cleared'); render(); } } }, 'Reset Data')) );
      return;
    }

    if(state.pageKey === 'login'){
      // Login / Setup / Forgot UI
      const admin = loadAdmin();
      const box = el('div', { class:'card' },
        el('div', {}, el('button', { class:'btn', onclick: ()=>openSetup() }, 'Setup Admin (create/change)')),
        el('div', { style:'margin-top:8px' }, el('button', { class:'btn', onclick: ()=>openLogin() }, 'Login')),
        el('div', { style:'margin-top:8px' }, el('button', { class:'btn', onclick: ()=>openReset() }, 'Forgot password (Recovery code)')),
        el('div', { style:'margin-top:8px' }, el('div', { class:'small' }, `Admin username: ${admin.username}`))
      );
      content.appendChild(box);
      return;
    }

    if(state.pageKey === 'logout'){
      state.adminLogged = false;
      showToast('Logged out');
      render();
      return;
    }
  } // end render

  /***************  IMPORT / EXPORT (CSV)  ***************/
  function toCSV(rows){
    return rows.map(r=>r.map(c=>{ const s=(c||'').toString(); if(/[",\\n]/.test(s)) return '"' + s.replace(/"/g,'""') + '"'; return s; }).join(',')).join('\n');
  }
  function parseCSV(text){
    const rows=[]; let row=[], cur='', inQ=false;
    for(let i=0;i<text.length;i++){ const c=text[i];
      if(inQ){ if(c==='"'){ if(text[i+1]==='"'){ cur+='"'; i++; } else inQ=false; } else cur+=c; }
      else { if(c==='"'){ inQ=true; } else if(c===','){ row.push(cur); cur=''; } else if(c==='\\n'){ row.push(cur); rows.push(row); row=[]; cur=''; } else if(c==='\\r'){ } else cur+=c; }
    }
    row.push(cur); rows.push(row); return rows;
  }

  function doImportCSV(){
    const input = document.getElementById('fileInput');
    if(!input || !input.files || !input.files[0]) return alert('Choose CSV first');
    const f = input.files[0];
    f.text().then(txt=>{
      const rows = parseCSV(txt); const header = rows.shift()||[];
      const idxV = header.findIndex(h=>/vaiphei/i.test(h)); const idxE = header.findIndex(h=>/english/i.test(h));
      if(idxV<0 || idxE<0) return alert('CSV must include Vaiphei and English columns');
      const seen = new Set(state.dict.map(d=> (d.vaiphei+'â†’'+d.english).toLowerCase() ));
      let added=0;
      rows.forEach(r=>{
        const it = { vaiphei:(r[idxV]||'').trim(), english:(r[idxE]||'').trim(), example:(r[header.findIndex(h=>/example/i.test(h))]||'').trim() };
        if(!it.vaiphei || !it.english) return;
        const k = (it.vaiphei+'â†’'+it.english).toLowerCase();
        if(seen.has(k)) return;
        state.dict.push(it); seen.add(k); added++;
      });
      state.dict.sort(compareEntries); saveDict(state.dict); showToast(`Imported ${added} entries`); render();
    });
  }

  function doExportCSV(){
    const rows = [['Vaiphei','English','Example'], ...state.dict.map(d=>[d.vaiphei,d.english,d.example||''])];
    const csv = toCSV(rows);
    const blob = new Blob([csv], { type:'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'tapkuang-dictionary.csv'; a.click(); URL.revokeObjectURL(url);
  }

  /***************  ADMIN FLOWS: Setup / Login / Reset  ***************/
  function openSetup(){
    const modal = makeModal();
    modal.content.innerHTML = `<h3>Setup Admin</h3>
      <label>Username <input id="su-user" class="input" value="${loadAdmin().username}"></label>
      <label>Email <input id="su-email" class="input" value="${loadAdmin().email}"></label>
      <label>Password <input id="su-pass" type="password" class="input"></label>
      <label>Recovery code (write down!) <input id="su-rec" type="password" class="input"></label>
      <div style="display:flex;gap:8px;margin-top:8px"><button id="su-save" class="btn">Save</button> <button id="su-cancel" class="btn">Cancel</button></div>`;
    modal.el.querySelector('#su-cancel').onclick = ()=>modal.close();
    modal.el.querySelector('#su-save').onclick = async ()=>{
      const u = modal.el.querySelector('#su-user').value.trim();
      const e = modal.el.querySelector('#su-email').value.trim();
      const p = modal.el.querySelector('#su-pass').value;
      const r = modal.el.querySelector('#su-rec').value;
      if(!u || !e) return alert('Enter username & email');
      const adm = loadAdmin() || {};
      adm.username = u; adm.email = e;
      if(p) adm.passHash = await sha256hex(p);
      if(r) adm.recHash = await sha256hex(r);
      saveAdmin(adm);
      showToast('Admin saved. Set a password to enable login.');
      modal.close();
      render();
    };
  }

  function openLogin(){
    const modal = makeModal();
    modal.content.innerHTML = `<h3>Admin Login</h3>
      <label>Username <input id="li-user" class="input" value="${loadAdmin().username}"></label>
      <label>Password <input id="li-pass" type="password" class="input"></label>
      <div style="display:flex;gap:8px;margin-top:8px"><button id="li-go" class="btn">Login</button> <button id="li-can" class="btn">Cancel</button></div>`;
    modal.el.querySelector('#li-can').onclick = ()=>modal.close();
    modal.el.querySelector('#li-go').onclick = async ()=>{
      const u = modal.el.querySelector('#li-user').value.trim();
      const p = modal.el.querySelector('#li-pass').value;
      const adm = loadAdmin();
      if(!adm || u !== adm.username) return alert('Wrong username');
      if(!adm.passHash) return alert('No password set. Use Setup Admin.');
      const h = await sha256hex(p);
      if(h !== adm.passHash) return alert('Wrong password');
      state.adminLogged = true;
      modal.close();
      showToast('Logged in');
      render();
    };
  }

  function openReset(){
    const modal = makeModal();
    modal.content.innerHTML = `<h3>Reset Password</h3>
      <label>Username <input id="re-user" class="input" value="${loadAdmin().username}"></label>
      <label>Recovery code <input id="re-code" type="password" class="input"></label>
      <label>New password <input id="re-new" type="password" class="input"></label>
      <div style="display:flex;gap:8px;margin-top:8px"><button id="re-do" class="btn">Reset</button><button id="re-c" class="btn">Cancel</button></div>`;
    modal.el.querySelector('#re-c').onclick = ()=>modal.close();
    modal.el.querySelector('#re-do').onclick = async ()=>{
      const u = modal.el.querySelector('#re-user').value.trim();
      const rc = modal.el.querySelector('#re-code').value;
      const np = modal.el.querySelector('#re-new').value;
      const adm = loadAdmin();
      if(!adm || u !== adm.username) return alert('Wrong username');
      if(!adm.recHash) return alert('No recovery code set');
      if(await sha256hex(rc) !== adm.recHash) return alert('Wrong recovery code');
      adm.passHash = np ? await sha256hex(np) : '';
      saveAdmin(adm);
      modal.close();
      showToast('Password reset successful');
    };
  }

  function openEditEntry(entry){
    const modal = makeModal();
    modal.content.innerHTML = `<h3>Edit Entry</h3>
      <label>Vaiphei <input id="ed-va" class="input" value="${entry.vaiphei}"></label>
      <label>English <input id="ed-en" class="input" value="${entry.english}"></label>
      <label>Example <input id="ed-ex" class="input" value="${entry.example||''}"></label>
      <div style="display:flex;gap:8px;margin-top:8px"><button id="ed-save" class="btn">Save</button><button id="ed-c" class="btn">Cancel</button></div>`;
    modal.el.querySelector('#ed-c').onclick = ()=>modal.close();
    modal.el.querySelector('#ed-save').onclick = async ()=>{
      const va = modal.el.querySelector('#ed-va').value.trim();
      const en = modal.el.querySelector('#ed-en').value.trim();
      const ex = modal.el.querySelector('#ed-ex').value.trim();
      if(!va||!en) return alert('Fill Vaiphei & English');
      // replace entry (match by original pair)
      state.dict = state.dict.map(d => (d.vaiphei===entry.vaiphei && d.english===entry.english) ? {vaiphei:va,english:en,example:ex} : d );
      state.dict.sort(compareEntries); saveDict(state.dict); modal.close(); showToast('Saved'); render();
    };
  }

  /***************  MODAL UTILS  ***************/
  function makeModal(){
    const back = el('div', { class:'modal-back' });
    const modal = el('div', { class:'modal' });
    back.appendChild(modal);
    document.body.appendChild(back);
    function close(){ back.remove(); }
    return { back, el: back, content: modal, close };
  }

  /***************  APP INIT  ***************/
  // Install simple PWA manifest (manifest.webmanifest file can be added when hosting).
  // Render initial view
  render();

  // Expose quick actions for top-level buttons / URL param for mode
  (function expose(){
    // Quick mode toggle in header (not visible as button but available via console)
    window.setMode = m => { state.mode = m; render(); };
  })();

  // small helper to show toast elsewhere
  window.showToast = showToast;

  // register service worker stub if hosting supports it (optional)
  if('serviceWorker' in navigator){
    try{ navigator.serviceWorker.register('sw.js').catch(()=>{}); }catch(e){}
  }
  </script>
</body>
</html>
