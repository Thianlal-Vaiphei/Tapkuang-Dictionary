<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tapkuang Vaiphei Dictionary</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)),
        url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAYACAIAAABn4K39AADXFWNhQlgAANcVanVtYgAAAB5qdW1kYzJwYQARABCAAACqADibcQNjMnBhAAAANxNqdW1iAAAAR2p1bWRjMm1hABEAEIAAAKoAOJtxA3VybjpjMnBhOjlkMGM4MmE2LTMwNT...') 
        no-repeat center center fixed;
      background-size: cover;
      color: #fff;
    }
    header {
      text-align: center;
      padding: 2rem;
    }
    header h1 {
      font-size: 2.5rem;
      margin: 0;
    }
    nav {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
      padding: 1rem;
    }
    .card {
      background: rgba(255,255,255,0.1);
      padding: 1.5rem;
      text-align: center;
      border-radius: 1rem;
      cursor: pointer;
      transition: 0.3s;
    }
    .card:hover {
      background: rgba(255,255,255,0.2);
    }
    section {
      display: none;
      padding: 1rem;
      background: rgba(0,0,0,0.6);
    }
    section.active {
      display: block;
    }
    h2 {
      margin-top: 1rem;
    }
    .word-entry {
      display: flex;
      justify-content: space-between;
      padding: 0.3rem 0.6rem;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    .admin-controls button {
      margin-left: 0.5rem;
    }
    input, button, select {
      padding: 0.5rem;
      margin: 0.3rem;
    }
    .letter-heading {
      background: rgba(255,255,255,0.2);
      padding: 0.4rem;
      font-weight: bold;
      margin-top: 0.6rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>Tapkuang Vaiphei Dictionary</h1>
  </header>
  <nav>
    <div class="card" onclick="showSection('v2e')">Vaiphei → English</div>
    <div class="card" onclick="showSection('e2v')">English → Vaiphei</div>
    <div class="card" onclick="showSection('addWord')">Add Word</div>
    <div class="card" onclick="showSection('importExcel')">Import Excel</div>
    <div class="card" onclick="showSection('settings')">Settings</div>
    <div class="card" onclick="showSection('login')">Login</div>
  </nav>

  <!-- Vaiphei → English -->
  <section id="v2e">
    <h2>Vaiphei → English</h2>
    <div id="dict-v2e"></div>
  </section>

  <!-- English → Vaiphei -->
  <section id="e2v">
    <h2>English → Vaiphei</h2>
    <div id="dict-e2v"></div>
  </section>

  <!-- Add Word -->
  <section id="addWord">
    <h2>Add Word</h2>
    <input id="word" placeholder="Word">
    <input id="meaning" placeholder="Meaning">
    <select id="dictType">
      <option value="v2e">Vaiphei → English</option>
      <option value="e2v">English → Vaiphei</option>
    </select>
    <button onclick="addWord()">Save</button>
  </section>

  <!-- Import Excel -->
  <section id="importExcel">
    <h2>Import from Excel</h2>
    <input type="file" id="excelFile">
    <select id="importType">
      <option value="v2e">Vaiphei → English</option>
      <option value="e2v">English → Vaiphei</option>
    </select>
    <button onclick="importExcel()">Import</button>
  </section>

  <!-- Settings -->
  <section id="settings">
    <h2>Settings</h2>
    <p>Change Admin Password</p>
    <input id="curPass" type="password" placeholder="Current Password">
    <input id="newPass" type="password" placeholder="New Password">
    <button onclick="changePassword()">Change</button>
    <button onclick="resetPassword()">Reset to Default</button>
  </section>

  <!-- Login -->
  <section id="login">
    <h2>Admin Login</h2>
    <input id="loginPass" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <button onclick="logout()">Logout</button>
  </section>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    // ===== Data =====
    let dictV2E = { a:[{word:"a",meaning:"yes"}] };
    let dictE2V = { a:[{word:"apple",meaning:"tuhpui"}] };

    // ===== Utils =====
    const VAIPHEI_ORDER = ["a","aw","b","ch","d","e","f","g","ng","h","i","j","k","l","m","n","o","p","r","s","t","u","v","z"];
    function isAdmin(){ return sessionStorage.getItem("isAdmin")==="1"; }

    // ===== UI =====
    function showSection(id){
      document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      if(id==="v2e") renderV2E();
      if(id==="e2v") renderE2V();
    }

    function renderV2E(){
      let html="";
      VAIPHEI_ORDER.forEach(letter=>{
        let entries = dictV2E[letter]||[];
        if(entries.length){
          html+=`<div class="letter-heading">${letter.toUpperCase()}</div>`;
          entries.forEach((e,i)=>{
            html+=`<div class="word-entry">${e.word} — ${e.meaning}`;
            if(isAdmin()){
              html+=`<span class="admin-controls"><button onclick="editWord('v2e','${letter}',${i})">✏️</button><button onclick="deleteWord('v2e','${letter}',${i})">❌</button></span>`;
            }
            html+=`</div>`;
          });
        }
      });
      document.getElementById("dict-v2e").innerHTML=html;
    }

    function renderE2V(){
      let html="";
      for(let c=65;c<=90;c++){
        let letter=String.fromCharCode(c).toLowerCase();
        let entries = dictE2V[letter]||[];
        if(entries.length){
          html+=`<div class="letter-heading">${letter.toUpperCase()}</div>`;
          entries.forEach((e,i)=>{
            html+=`<div class="word-entry">${e.word} — ${e.meaning}`;
            if(isAdmin()){
              html+=`<span class="admin-controls"><button onclick="editWord('e2v','${letter}',${i})">✏️</button><button onclick="deleteWord('e2v','${letter}',${i})">❌</button></span>`;
            }
            html+=`</div>`;
          });
        }
      }
      document.getElementById("dict-e2v").innerHTML=html;
    }

    // ===== Word management =====
    function addWord(){
      if(!isAdmin()){alert("Admin only");return;}
      let w=document.getElementById("word").value.trim();
      let m=document.getElementById("meaning").value.trim();
      let type=document.getElementById("dictType").value;
      if(!w||!m) return;
      let key=w.toLowerCase().replace(/[^a-z]/g,'');
      if(!key) return;
      if(type==="v2e"){ dictV2E[key]=dictV2E[key]||[]; dictV2E[key].push({word:w,meaning:m}); renderV2E(); }
      else { dictE2V[key]=dictE2V[key]||[]; dictE2V[key].push({word:w,meaning:m}); renderE2V(); }
    }

    function editWord(type,letter,i){
      let obj=(type==="v2e"?dictV2E:dictE2V)[letter][i];
      let nw=prompt("Edit word:",obj.word);
      let nm=prompt("Edit meaning:",obj.meaning);
      if(nw&&nm){ obj.word=nw; obj.meaning=nm; (type==="v2e"?renderV2E():renderE2V()); }
    }

    function deleteWord(type,letter,i){
      if(confirm("Delete this word?")){
        (type==="v2e"?dictV2E:dictE2V)[letter].splice(i,1);
        (type==="v2e"?renderV2E():renderE2V());
      }
    }

    // ===== Excel Import =====
    function importExcel(){
      if(!isAdmin()){alert("Admin only");return;}
      let file=document.getElementById("excelFile").files[0];
      if(!file) return;
      let type=document.getElementById("importType").value;
      let reader=new FileReader();
      reader.onload=function(e){
        let data=new Uint8Array(e.target.result);
        let wb=XLSX.read(data,{type:'array'});
        let sheet=wb.Sheets[wb.SheetNames[0]];
        let rows=XLSX.utils.sheet_to_json(sheet,{header:1});
        rows.slice(1).forEach(r=>{
          if(r[0]&&r[1]){
            let w=r[0].toString().trim();
            let m=r[1].toString().trim();
            let key=w.toLowerCase().replace(/[^a-z]/g,'');
            if(!key) return;
            if(type==="v2e"){ dictV2E[key]=dictV2E[key]||[]; dictV2E[key].push({word:w,meaning:m}); }
            else { dictE2V[key]=dictE2V[key]||[]; dictE2V[key].push({word:w,meaning:m}); }
          }
        });
        if(type==="v2e") renderV2E(); else renderE2V();
      };
      reader.readAsArrayBuffer(file);
    }

    // ===== Admin Login =====
    function login(){
      let p=document.getElementById("loginPass").value;
      let saved=localStorage.getItem("adminPassword")||"tapkuang123";
      if(p===saved){ sessionStorage.setItem("isAdmin","1"); alert("Logged in"); }
      else alert("Wrong password");
    }
    function logout(){ sessionStorage.removeItem("isAdmin"); alert("Logged out"); }
    function changePassword(){
      if(!isAdmin()){alert("Admin only");return;}
      let cur=document.getElementById("curPass").value;
      let nw=document.getElementById("newPass").value;
      let saved=localStorage.getItem("adminPassword")||"tapkuang123";
      if(cur===saved && nw){ localStorage.setItem("adminPassword",nw); alert("Password changed"); }
      else alert("Wrong current password");
    }
    function resetPassword(){
      if(!isAdmin()){alert("Admin only");return;}
      localStorage.setItem("adminPassword","tapkuang123");
      alert("Password reset to default");
    }

    // ===== Init =====
    showSection("v2e");
  </script>
</body>
</html>
