<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tapkuang - Vaiphei Dictionary</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#f5f5f5; }
    header { text-align:center; background:#222; color:#fff; padding:20px; }
    header img { max-width:150px; border-radius:12px; }
    nav { display:grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap:15px; padding:20px; }
    nav button { padding:15px; font-size:16px; border:none; border-radius:12px; background:#0078d7; color:white; cursor:pointer; transition:0.2s; }
    nav button:hover { background:#005fa3; }
    section { padding:20px; display:none; }
    section.active { display:block; }
    .author { background:#fff; padding:20px; margin:20px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.15); font-style:italic; text-align:center; }
    .warning { color:red; font-weight:bold; margin:10px 0; }
    ul { list-style:none; padding:0; }
    li { background:#fff; margin:5px 0; padding:10px; border-radius:8px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 1px 4px rgba(0,0,0,0.1); }
    .actions button { margin-left:6px; padding:6px 10px; border:none; border-radius:6px; cursor:pointer; }
    .edit-btn { background:#f39c12; color:white; }
    .edit-btn:hover { background:#d68910; }
    .delete-btn { background:#e74c3c; color:#fff; }
    .delete-btn:hover { background:#c0392b; }
  </style>
</head>
<body>

<header>
  <img src="cover.jpg" alt="Cover Image" onerror="this.style.display='none'">
  <h1>üìñ Tapkuang - Vaiphei Dictionary</h1>
  <p>English ‚Üî Vaiphei Translator</p>
</header>

<nav>
  <button onclick="showSection('search')">üîç Search</button>
  <button onclick="showSection('dictionary')">üìö Dictionary</button>
  <button onclick="showSection('import')">üì• Import Excel</button>
  <button onclick="exportExcel()">üì§ Export Excel</button>
  <button onclick="showSection('addword')">‚ûï Add Word</button>
</nav>

<section id="search">
  <h2>Search Word</h2>
  <input type="text" id="searchInput" placeholder="Type a word..." oninput="searchWord()">
  <div id="searchResult"></div>
</section>

<section id="dictionary">
  <h2>All Words</h2>
  <ul id="wordList"></ul>
</section>

<section id="import">
  <h2>Import Excel</h2>
  <p class="warning">‚ö† Please export and backup before importing new Excel files.</p>
  <input type="file" id="fileInput" accept=".xlsx">
  <button onclick="importExcel()">Import</button>
</section>

<section id="addword">
  <h2 id="formTitle">Add a New Word</h2>
  <input type="text" id="newWord" placeholder="English or Vaiphei">
  <input type="text" id="newMeaning" placeholder="Meaning">
  <button id="saveBtn" onclick="addWord()">Add</button>
  <button id="updateBtn" onclick="updateWord()" style="display:none;">Update Word</button>
  <button id="cancelBtn" onclick="cancelEdit()" style="display:none;">Cancel</button>
</section>

<div class="author">
  <p>This dictionary is made with love for the Vaiphei language.  
  It is my humble dream to preserve and share our words for future generations.  
  May this tool help learners and speakers alike.  
  Thank you!</p>
</div>

<script>
  let dictionary = JSON.parse(localStorage.getItem("dictionary")) || [];
  let editingIndex = null;

  function showSection(id) {
    document.querySelectorAll("section").forEach(sec => sec.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    if (id === "dictionary") renderList();
  }

  function searchWord() {
    let input = document.getElementById("searchInput").value.toLowerCase();
    let result = dictionary.filter(item =>
      item.word.toLowerCase().includes(input) || item.meaning.toLowerCase().includes(input)
    );
    document.getElementById("searchResult").innerHTML =
      result.map(r => `<p><b>${r.word}</b> ‚Üí ${r.meaning}</p>`).join("") || "No result";
  }

  function renderList() {
    let list = document.getElementById("wordList");
    list.innerHTML = dictionary
      .sort((a,b) => a.word.localeCompare(b.word))
      .map((r, i) => 
        `<li>
          <span><b>${r.word}</b> ‚Üí ${r.meaning}</span> 
          <span class="actions">
            <button class="edit-btn" onclick="startEdit(${i})">Edit</button>
            <button class="delete-btn" onclick="deleteWord(${i})">Delete</button>
          </span>
        </li>`
      )
      .join("");
  }

  function addWord() {
    let word = document.getElementById("newWord").value.trim();
    let meaning = document.getElementById("newMeaning").value.trim();
    if (!word || !meaning) return alert("Please enter both word and meaning.");

    let existing = dictionary.findIndex(item => item.word.toLowerCase() === word.toLowerCase());
    if (existing !== -1) {
      dictionary[existing].meaning = meaning; 
      alert("Word updated!");
    } else {
      dictionary.push({ word, meaning });
      alert("Word added!");
    }
    localStorage.setItem("dictionary", JSON.stringify(dictionary));
    clearForm();
  }

  function startEdit(index) {
    editingIndex = index;
    let item = dictionary[index];
    document.getElementById("newWord").value = item.word;
    document.getElementById("newMeaning").value = item.meaning;

    document.getElementById("formTitle").innerText = "Edit Word";
    document.getElementById("saveBtn").style.display = "none";
    document.getElementById("updateBtn").style.display = "";
    document.getElementById("cancelBtn").style.display = "";
    showSection("addword");
  }

  function updateWord() {
    if (editingIndex === null) return;

    let word = document.getElementById("newWord").value.trim();
    let meaning = document.getElementById("newMeaning").value.trim();
    if (!word || !meaning) return alert("Please enter both word and meaning.");

    dictionary[editingIndex] = { word, meaning };
    localStorage.setItem("dictionary", JSON.stringify(dictionary));
    alert("Word updated!");
    clearForm();
    showSection("dictionary");
  }

  function cancelEdit() {
    clearForm();
    showSection("dictionary");
  }

  function clearForm() {
    document.getElementById("newWord").value = "";
    document.getElementById("newMeaning").value = "";
    editingIndex = null;
    document.getElementById("formTitle").innerText = "Add a New Word";
    document.getElementById("saveBtn").style.display = "";
    document.getElementById("updateBtn").style.display = "none";
    document.getElementById("cancelBtn").style.display = "none";
  }

  function importExcel() {
    let file = document.getElementById("fileInput").files[0];
    if (!file) return alert("Please select a file first.");
    let reader = new FileReader();
    reader.onload = function(e) {
      let data = new Uint8Array(e.target.result);
      let workbook = XLSX.read(data, { type: "array" });
      let sheet = workbook.Sheets[workbook.SheetNames[0]];
      let imported = XLSX.utils.sheet_to_json(sheet);
      imported.forEach(row => {
        if (row.Word && row.Meaning) {
          let existing = dictionary.findIndex(item => item.word.toLowerCase() === row.Word.toLowerCase());
          if (existing !== -1) {
            dictionary[existing].meaning = row.Meaning; 
          } else {
            dictionary.push({ word: row.Word, meaning: row.Meaning });
          }
        }
      });
      localStorage.setItem("dictionary", JSON.stringify(dictionary));
      alert("Words imported successfully (duplicates updated)!");
      renderList();
    };
    reader.readAsArrayBuffer(file);
  }

  function exportExcel() {
    if (dictionary.length === 0) return alert("No words to export.");
    let ws = XLSX.utils.json_to_sheet(dictionary.map(r => ({ Word: r.word, Meaning: r.meaning })));
    let wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Dictionary");
    XLSX.writeFile(wb, "Vaiphei_Dictionary.xlsx");
  }

  function deleteWord(index) {
    if (confirm("Are you sure you want to delete this word?")) {
      dictionary.splice(index, 1);
      localStorage.setItem("dictionary", JSON.stringify(dictionary));
      renderList();
    }
  }
</script>

</body>
</html>
