<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tapkuang – Vaiphei Dictionary</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: url("cover.jpg") no-repeat center center fixed;
      background-size: cover;
    }
    header {
      background: rgba(0,0,0,0.6);
      color: white; padding: 10px;
      text-align: center;
    }
    nav {
      background: #333; display: flex; flex-wrap: wrap; justify-content: center;
    }
    nav button {
      margin: 5px; padding: 8px 12px;
      border: none; border-radius: 5px;
      background: #555; color: white;
      cursor: pointer;
    }
    nav button:hover { background: #777; }
    section { padding: 20px; background: rgba(255,255,255,0.95); margin: 10px; border-radius: 10px; }
    .hidden { display: none; }
    table { width: 100%; border-collapse: collapse; margin-top:10px;}
    td, th { border: 1px solid #ccc; padding: 5px; text-align: left; }
    .admin-only { display: none; }
    footer { text-align:center; padding:10px; background:#eee; }
  </style>
</head>
<body>
  <header>
    <h1>📖 Tapkuang – Vaiphei Dictionary</h1>
  </header>

  <nav>
    <button onclick="showPage('search')">🔍 Hawlna</button>
    <button onclick="showPage('add')">➕ Thumal belapna</button>
    <button onclick="showPage('import')">⬆ Excel laklutna</button>
    <button onclick="showPage('export')">⬇ Excel belhna</button>
    <button onclick="showPage('login')">🔑 Lutna</button>
    <button onclick="logout()">🚪 Pawtna</button>
  </nav>

  <!-- Search Page -->
  <section id="search">
    <h2>🔍 Hawlna</h2>
    <select id="modeSearch">
      <option value="ve">Vaiphei → English</option>
      <option value="ev">English → Vaiphei</option>
    </select>
    <input type="text" id="searchBox" placeholder="Type to search..." oninput="searchWord()">
    <div id="results"></div>
  </section>

  <!-- Add/Edit/Delete -->
  <section id="add" class="hidden admin-only">
    <h2>➕ Thumal belapna</h2>
    <select id="modeAdd">
      <option value="ve">Vaiphei → English</option>
      <option value="ev">English → Vaiphei</option>
    </select><br><br>
    <input type="text" id="wordInput" placeholder="Word">
    <input type="text" id="meaningInput" placeholder="Meaning">
    <button onclick="addWord()">Add</button>
    <div id="addMsg"></div>
    <h3>📋 Current Words</h3>
    <div id="wordList"></div>
  </section>

  <!-- Import -->
  <section id="import" class="hidden admin-only">
    <h2>⬆ Excel laklutna</h2>
    <select id="modeImport">
      <option value="ve">Vaiphei → English</option>
      <option value="ev">English → Vaiphei</option>
    </select><br><br>
    <input type="file" id="importFile">
    <button onclick="importExcel()">Import</button>
  </section>

  <!-- Export -->
  <section id="export" class="hidden admin-only">
    <h2>⬇ Excel belhna</h2>
    <button onclick="exportExcel('ve')">Export V→E</button>
    <button onclick="exportExcel('ev')">Export E→V</button>
  </section>

  <!-- Login -->
  <section id="login" class="hidden">
    <h2>🔑 Lutna</h2>
    <input type="password" id="adminPass" placeholder="Enter password">
    <button onclick="login()">Login</button>
    <div id="loginMsg"></div>
  </section>

  <footer>
    <p>© Ph Thianneilal Vaiphei 2025</p>
  </footer>

  <script>
    let dictionary = { ve: [], ev: [] };
    const ADMIN_PASSWORD = "tapkuang";

    function loadDictionary() {
      const data = localStorage.getItem("dictionary");
      if (data) dictionary = JSON.parse(data);
      refreshWordList();
    }
    function saveDictionary() {
      localStorage.setItem("dictionary", JSON.stringify(dictionary));
      refreshWordList();
    }

    function showPage(id) {
      document.querySelectorAll("section").forEach(sec => sec.classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
      if (id==="add") refreshWordList();
    }

    function addWord() {
      const mode = document.getElementById("modeAdd").value;
      const word = document.getElementById("wordInput").value.trim();
      const meaning = document.getElementById("meaningInput").value.trim();
      if (!word || !meaning) return;
      const idx = dictionary[mode].findIndex(item => item.word === word);
      if (idx !== -1) {
        dictionary[mode][idx].meaning = meaning;
        document.getElementById("addMsg").innerText = "✏️ Updated!";
      } else {
        dictionary[mode].push({ word, meaning });
        document.getElementById("addMsg").innerText = "✅ Added!";
      }
      saveDictionary();
      document.getElementById("wordInput").value = "";
      document.getElementById("meaningInput").value = "";
    }

    function deleteWord(mode, word) {
      dictionary[mode] = dictionary[mode].filter(item => item.word !== word);
      saveDictionary();
    }

    function refreshWordList() {
      const mode = document.getElementById("modeAdd").value;
      let html = "<table><tr><th>Word</th><th>Meaning</th><th>Action</th></tr>";
      dictionary[mode].forEach(item => {
        html += `<tr><td>${item.word}</td><td>${item.meaning}</td>
        <td><button onclick="deleteWord('${mode}','${item.word}')">❌ Delete</button></td></tr>`;
      });
      html += "</table>";
      document.getElementById("wordList").innerHTML = html;
    }

    document.getElementById("modeAdd").addEventListener("change", refreshWordList);

    function searchWord() {
      const mode = document.getElementById("modeSearch").value;
      const q = document.getElementById("searchBox").value.toLowerCase();
      const res = dictionary[mode].filter(item => item.word.toLowerCase().startsWith(q));
      let html = "<table><tr><th>Word</th><th>Meaning</th></tr>";
      res.forEach(item => html += `<tr><td>${item.word}</td><td>${item.meaning}</td></tr>`);
      html += "</table>";
      document.getElementById("results").innerHTML = html;
    }

    function importExcel() {
      const file = document.getElementById("importFile").files[0];
      const mode = document.getElementById("modeImport").value;
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const rows = XLSX.utils.sheet_to_json(sheet);
        rows.forEach(r => {
          if (r.Word && r.Meaning) {
            dictionary[mode].push({ word: r.Word, meaning: r.Meaning });
          }
        });
        saveDictionary();
        alert("✅ Imported!");
      };
      reader.readAsArrayBuffer(file);
    }

    function exportExcel(mode) {
      const ws = XLSX.utils.json_to_sheet(dictionary[mode]);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Dictionary");
      XLSX.writeFile(wb, `dictionary_${mode}.xlsx`);
    }

    function login() {
      const pass = document.getElementById("adminPass").value;
      if (pass === ADMIN_PASSWORD) {
        document.querySelectorAll(".admin-only").forEach(el => el.style.display = "block");
        document.getElementById("loginMsg").innerText = "✅ Logged in!";
      } else {
        document.getElementById("loginMsg").innerText = "❌ Wrong password!";
      }
    }

    function logout() {
      document.querySelectorAll(".admin-only").forEach(el => el.style.display = "none");
    }

    loadDictionary();
  </script>
</body>
</html>
